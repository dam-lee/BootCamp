# 콜백 함수
* 다른 코드의 인자로 넘겨주는 함수를 말한다.
* 콜백 함수를 인자로 넘겨받은 코드는 콜백 함수를 필요에 따라 원하는 시점에 실행된다.
* 매개변수를 통해 함수 외부에서 콜백함수를 받는 함수를 고차함수라고 한다.
* 고차 함수는 매개변수를 통해 전달받은 콜백 함수의 호출 시점을 결정해서 호출한다.
* 콜백함수는 **고차함수에 의해 호출**되며 이때 고차 함수는 필요에 따라 콜백 함수에 인수를 전달할 수 있다.
* 콜백함수로서 전달된 함수는 **고차함수가 호출될 때마다 평가되어 함수 객체를 생성**한다.
* 콜백함수를 다른곳에서 호출할 필요가 있거나, 콜백 함수를 전달받는 함수가 자주 호출된다면 함수 외부에서 콜백 함수를 정의한 후 함수 참조를 고차 함수에 전달하는 편이 좋다.
```javascript
//logOdds 함수는 단 한번만 생성된다.
var logOdds = function(i){
  if(i % 2) console.log(i)
}
// 고차 함수에 함수 참조를 전달한다.
repeat(5,logOdds); // 1,3
```
* 위 예제의 logOdds 함수는 단 한번만 생성되지만, 콜백 함수를 익명 함수로 정의하면서 바로 고차 함수에 전달하면 **고차 함수가 호출될 때마다 콜백함수가 생성**된다.
* 콜백 함수는 비동기 처리에도 활용되며, **모든 콜백 함수가 고차함수에 의해 호출되지는 않는다. 예로 setTimeout 함수의 콜백 함수는 setTimeout 함수가 호출되지 않는다**
* 콜백 함수도 함수이기 때문에 **기본적으로 this가 전역객체를 참조하지만, 제어권을 넘겨받을 코드에서 콜백 함수에 별도로 this가 대상을 지정할 경우 그 대상을 참조한다**
```javascript
var obj = {
  vals:[1,2,3],
  logValues:function(v,i){
    console.log(v,i)
  }
};
obj.logValues(1,2); // {vals:[1,2,3], logValues:f}
[4,5,6].forEach(obj.logValues) // window , -> 콜백함수가 인자로 함수를 전달받은 것이기 때문에 window
```

## 콜백 지옥과 비동기 제어
* 콜백 지옥은 콜백 함수를 익명 함수로 전달하는 과정이 반복되어 코드의 가독성이 떨어지는 현상을 말한다.
* 비동기는 동기의 반대로, **동기적인 코드는 현재 실행중인 코드가 완료된 후 다음 코드를 실행**하는 방식이며, **비동기적인 코드는 현재 실행중인 코드의 완료 여부와 상관없이 즉시 다음 코드로 넘어가는 것**을 말한다.
* **Promise 함수는 함수 자체로는 동기적으로 실행되며, .then 부터가 비동기로 동작**된다.

```javascript
// 비동기 작업의 동기적 표현 Promise 

const addCoffee = function(name){
  // name에 .then() 인자로 넘겨준 값들이 들어온다. (에스프레소, 아메리카노 등) 
  return function closure(prevName){ // 호출할때마다 새로 생성되는 함수. 함수가 일으르 마치면 종료되고 호출하면 다시 생성된다.  클로저이며, 클로저인 함수는 부모 함수의 매개변수를 참조할 수 있다. 
  // prevName 에 promise의 resolve가 반환한 값이 계속 있다.  (0. undefined 1. 에스프레소 2. 에스프레소, 아메리카노 3. 에스프레소, 아메리카노, 카페모카)
  // 중첩된 함수는 외부 범위(scope)에서 선언한 변수에도 접근할 수 있다. (클로저)
    return new Promise(function(resolve){
      setTimeout(function(){
        // 부모 함수의 매개변수 name을 참조할 수 있다. (클로저)
        const newName = prevName ? `${prevName}, ${name}` : name;
        console.log(newName);
        resolve(newName)
      },500)
    })
  }
}

addCoffee("에스프레소")().then(addCoffee("아메리카노")).then(addCoffee("카페모카")).then(addCoffee("카페라떼"))
// 에스프레소
// 에스프레소, 아메리카노
// 에스프레소, 아메리카노, 카페모카
// 에스프레소, 아메리카노, 카페모카, 카페라떼
```
